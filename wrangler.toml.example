name = "smartcdn"
main = "dist/worker.js"
compatibility_date = "2024-12-01"

# Build configuration
[build]
command = "npm run build"

# Development environment (default)
[env.development]
name = "smartcdn-dev"

[env.development.vars]
ENVIRONMENT = "development"
# Geographic Routing Origins
# Replace these with your origin server URLs
GEO_ORIGIN_NA = "https://your-origin-na.example.com"
GEO_ORIGIN_EU = "https://your-origin-eu.example.com"
GEO_ORIGIN_ASIA = "https://your-origin-asia.example.com"
GEO_ORIGIN_DEFAULT = "https://your-origin.example.com"
# Cache TTLs (in seconds)
CACHE_TTL_IMAGES = "2592000"  # 30 days
CACHE_TTL_CSS_JS = "604800"   # 7 days
CACHE_TTL_HTML = "3600"       # 1 hour
CACHE_TTL_API = "300"         # 5 minutes
CACHE_TTL_DEFAULT = "86400"   # 1 day
# Feature Flags
FEATURE_AB_TESTING = "true"
FEATURE_GEO_ROUTING = "true"
FEATURE_REGION_CONTENT = "true"
FEATURE_RATE_LIMITING = "false"
FEATURE_STALE_WHILE_REVALIDATE = "true"
FEATURE_CACHE_BYPASS = "true"
# Rate Limiting
RATE_LIMIT_MAX_REQUESTS = "1000"  # Higher limit for dev
RATE_LIMIT_WINDOW_SECONDS = "60"
# Stale-While-Revalidate
SWR_MAX_AGE = "300"              # 5 minutes (shorter for dev)
SWR_STALE_WHILE_REVALIDATE = "3600"  # 1 hour

# Staging environment
[env.staging]
name = "smartcdn-staging"

# Service binding to origin worker (optional but recommended)
# Configure this if your origin is also a Cloudflare Worker
# Both workers must be in the same Cloudflare account
# [[env.staging.services]]
# binding = "ORIGIN"
# service = "your-origin-worker-name"

[env.staging.vars]
ENVIRONMENT = "staging"
# Geographic Routing Origins
GEO_ORIGIN_NA = "https://your-origin-na.example.com"
GEO_ORIGIN_EU = "https://your-origin-eu.example.com"
GEO_ORIGIN_ASIA = "https://your-origin-asia.example.com"
GEO_ORIGIN_DEFAULT = "https://your-origin.example.com"
# Cache TTLs (in seconds)
CACHE_TTL_IMAGES = "2592000"  # 30 days
CACHE_TTL_CSS_JS = "604800"   # 7 days
CACHE_TTL_HTML = "1800"       # 30 minutes (shorter for staging)
CACHE_TTL_API = "300"         # 5 minutes
CACHE_TTL_DEFAULT = "86400"   # 1 day
# Feature Flags
FEATURE_AB_TESTING = "true"
FEATURE_GEO_ROUTING = "true"
FEATURE_REGION_CONTENT = "true"
FEATURE_RATE_LIMITING = "true"
FEATURE_STALE_WHILE_REVALIDATE = "true"
FEATURE_CACHE_BYPASS = "true"
# Rate Limiting
RATE_LIMIT_MAX_REQUESTS = "200"  # Moderate limit for staging
RATE_LIMIT_WINDOW_SECONDS = "60"
# Stale-While-Revalidate
SWR_MAX_AGE = "1800"             # 30 minutes
SWR_STALE_WHILE_REVALIDATE = "7200"  # 2 hours

# Production environment
[env.production]
name = "smartcdn"

[env.production.vars]
ENVIRONMENT = "production"
# Geographic Routing Origins
GEO_ORIGIN_NA = "https://your-origin-na.example.com"
GEO_ORIGIN_EU = "https://your-origin-eu.example.com"
GEO_ORIGIN_ASIA = "https://your-origin-asia.example.com"
GEO_ORIGIN_DEFAULT = "https://your-origin.example.com"
# Cache TTLs (in seconds)
CACHE_TTL_IMAGES = "2592000"  # 30 days
CACHE_TTL_CSS_JS = "604800"   # 7 days
CACHE_TTL_HTML = "3600"       # 1 hour
CACHE_TTL_API = "300"         # 5 minutes
CACHE_TTL_DEFAULT = "86400"   # 1 day
# Feature Flags
FEATURE_AB_TESTING = "true"
FEATURE_GEO_ROUTING = "true"
FEATURE_REGION_CONTENT = "true"
FEATURE_RATE_LIMITING = "true"
FEATURE_STALE_WHILE_REVALIDATE = "true"
FEATURE_CACHE_BYPASS = "true"
# Rate Limiting
RATE_LIMIT_MAX_REQUESTS = "100"  # Production limit
RATE_LIMIT_WINDOW_SECONDS = "60"
# Stale-While-Revalidate
SWR_MAX_AGE = "3600"             # 1 hour
SWR_STALE_WHILE_REVALIDATE = "86400"  # 24 hours

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
